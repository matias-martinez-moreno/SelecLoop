<!-- ===== TEMPLATE: AGREGAR EXPERIENCIA LABORAL ===== -->
<!-- Formulario para agregar una nueva experiencia laboral -->
<!-- Crea automáticamente una reseña pendiente -->
<!-- core/templates/core/add_work_history.html -->
{% extends 'core/base.html' %}

{% block title %}{{ title }} - SelecLoop{% endblock %}

{% block content %}
<!-- ===== CONTENIDO PRINCIPAL ===== -->
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- ===== HEADER ===== -->
            <div class="text-center mb-5">
                <h1 class="display-4 text-primary mb-3">
                    <i class="fas fa-briefcase me-3"></i>
                    {{ title }}
                </h1>
                <p class="lead text-muted">Agrega una experiencia laboral y crea automáticamente una reseña pendiente</p>
            </div>

            <!-- ===== FORMULARIO ===== -->
            <div class="card shadow-lg">
                <div class="card-body p-5">
                    <form method="post">
                        {% csrf_token %}

                        <!-- ===== INFORMACIÓN BÁSICA ===== -->
                        <h3 class="text-primary mb-4">
                            <i class="fas fa-info-circle me-2"></i>
                            Información de la Empresa
                        </h3>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-4">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-building me-2"></i>
                                        Empresa
                                    </label>
                                    {{ form.company_name }}
                                    {% if form.company_name.errors %}
                                        <div class="text-danger small mt-1">{{ form.company_name.errors.0 }}</div>
                                    {% endif %}
                                    <small class="text-muted">Escribe el nombre de la empresa o selecciona una existente de la lista</small>
                                    <!-- Lista de empresas para autocompletado -->
                                    <datalist id="companies-list">
                                        {% for company in existing_companies %}
                                            <option value="{{ company.name }}">
                                        {% endfor %}
                                    </datalist>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-4">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-briefcase me-2"></i>
                                        Cargo o Puesto
                                    </label>
                                    {{ form.job_title }}
                                    {% if form.job_title.errors %}
                                        <div class="text-danger small mt-1">{{ form.job_title.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- ===== FECHAS ===== -->
                        <h3 class="text-primary mb-4 mt-5">
                            <i class="fas fa-calendar me-2"></i>
                            Período de Trabajo
                        </h3>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-4">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-play me-2"></i>
                                        Fecha de Inicio
                                    </label>
                                    {{ form.start_date }}
                                    {% if form.start_date.errors %}
                                        <div class="text-danger small mt-1">{{ form.start_date.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-4">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-stop me-2"></i>
                                        Fecha de Finalización
                                    </label>
                                    {{ form.end_date }}
                                    {% if form.end_date.errors %}
                                        <div class="text-danger small mt-1">{{ form.end_date.errors.0 }}</div>
                                    {% endif %}
                                    <small class="text-muted">Deja vacío si aún trabajas aquí</small>
                                </div>
                            </div>
                        </div>

                        <!-- ===== ESTADO ACTUAL ===== -->
                        <div class="mb-4">
                            <div class="form-check">
                                {{ form.is_current_job }}
                                <label class="form-check-label fw-bold" for="{{ form.is_current_job.id_for_label }}">
                                    <i class="fas fa-check-circle me-2"></i>
                                    Es mi trabajo actual
                                </label>
                            </div>
                            {% if form.is_current_job.errors %}
                                <div class="text-danger small mt-1">{{ form.is_current_job.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <!-- ===== INFORMACIÓN ADICIONAL ===== -->
                        <div class="alert alert-info">
                            <h6 class="alert-heading">
                                <i class="fas fa-lightbulb me-2"></i>
                                ¿Qué sucede al agregar esta experiencia?
                            </h6>
                            <ul class="mb-0">
                                <li>Se creará automáticamente una reseña pendiente para esta empresa</li>
                                <li>Podrás acceder al contenido completo del sistema</li>
                                <li>La reseña pendiente aparecerá en "Mis Reseñas"</li>
                            </ul>
                        </div>

                        <!-- ===== BOTONES DE ACCIÓN ===== -->
                        <div class="text-center mt-5">
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="fas fa-save me-2"></i>
                                Agregar Experiencia
                            </button>
                            <a href="{% url 'work_history' %}" class="btn btn-secondary btn-lg ms-2">
                                <i class="fas fa-arrow-left me-2"></i>
                                Cancelar
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Estilos para el formulario */
.form-check {
    padding: 1rem;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.form-check:hover {
    border-color: var(--blue-400);
    background-color: #f8fafc;
}

.form-check-input {
    margin-right: 0.5rem;
    transform: scale(1.2);
}

.form-check-label {
    font-weight: 500;
    cursor: pointer;
    margin-left: 0.5rem;
}

/* Mejorar la apariencia de los campos */
.form-control, .form-select {
    padding: 0.75rem 1rem;
    font-size: 1rem;
    border-radius: 8px;
    border: 2px solid #e5e7eb;
    transition: all 0.3s ease;
    background-color: white;
}

.form-control:focus, .form-select:focus {
    border-color: var(--blue-500);
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    outline: none;
}

.form-control:hover, .form-select:hover {
    border-color: var(--blue-400);
}

.alert-info {
    background-color: #dbeafe;
    border-color: #3b82f6;
    color: #1c3d9c;
}
</style>

<script>
// JavaScript para manejar el checkbox de trabajo actual
document.addEventListener('DOMContentLoaded', function() {
    const currentJobCheckbox = document.getElementById('{{ form.is_current_job.id_for_label }}');
    const endDateField = document.getElementById('{{ form.end_date.id_for_label }}');
    
    if (currentJobCheckbox && endDateField) {
        function toggleEndDate() {
            if (currentJobCheckbox.checked) {
                endDateField.disabled = true;
                endDateField.value = '';
                endDateField.style.opacity = '0.5';
            } else {
                endDateField.disabled = false;
                endDateField.style.opacity = '1';
            }
        }
        
        // Ejecutar al cargar la página
        toggleEndDate();
        
        // Ejecutar cuando cambie el checkbox
        currentJobCheckbox.addEventListener('change', toggleEndDate);
    }
    
    // Mejorar funcionalidad del campo de empresa
    const companyInput = document.getElementById('company-input');
    const datalist = document.getElementById('companies-list');
    
    if (companyInput && datalist) {
        // Mejorar la experiencia del usuario
        companyInput.addEventListener('focus', function() {
            this.setAttribute('placeholder', 'Escribe o selecciona una empresa...');
        });
        
        companyInput.addEventListener('blur', function() {
            this.setAttribute('placeholder', 'Ej: Google, Microsoft, Empresa Local...');
        });
        
        // Mostrar indicador visual cuando se selecciona una empresa existente
        companyInput.addEventListener('input', function() {
            const value = this.value;
            const options = Array.from(datalist.options);
            const exactMatch = options.find(option => option.value === value);
            
            if (exactMatch) {
                this.style.borderColor = '#28a745';
                this.style.backgroundColor = '#f8fff9';
            } else {
                this.style.borderColor = '';
                this.style.backgroundColor = '';
            }
        });
    }
});
</script>
{% endblock %}
