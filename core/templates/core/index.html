<!-- ===== TEMPLATE: DASHBOARD PRINCIPAL ===== -->
<!-- Dashboard para candidatos - muestra empresas disponibles y reseñas pendientes -->
<!-- core/templates/core/index.html -->
{% extends 'core/base.html' %}

{% block title %}SelecLoop - Encuentra Reseñas de Empresas por Ubicación{% endblock %}

{% block meta_description %}SelecLoop es la plataforma líder en recolección de feedback empresarial en Colombia. Comparte reseñas anónimas de procesos de selección, encuentra información detallada sobre empresas, modalidades de trabajo y experiencias de otros candidatos. Filtra por ciudad, sector y tipo de empleo.{% endblock %}

{% block meta_keywords %}reseñas empresas Colombia, procesos selección, feedback empresarial, evaluaciones trabajo, experiencias laborales, calificaciones empresas, reviews empresas, candidatos Colombia, recursos humanos, empleo Colombia, trabajo remoto, trabajo presencial, trabajo híbrido, entrevistas trabajo, selección personal, empresas Medellín, empresas Bogotá, empresas Cali{% endblock %}

{% block og_title %}SelecLoop - Plataforma de Feedback Empresarial{% endblock %}

{% block og_description %}Descubre experiencias reales de candidatos en procesos de selección. SelecLoop te ayuda a tomar decisiones informadas sobre empresas y oportunidades laborales en Colombia.{% endblock %}

{% block content %}
<!-- ===== ESTILOS CSS PARA TARJETAS DE EMPRESAS ===== -->
<style>
.company-card {
    position: relative;
    overflow: hidden;
}

.company-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
}

.company-card:hover::before {
    left: 100%;
}

.company-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 15px 35px rgba(0,0,0,0.2);
}

.company-card .card-header {
    position: relative;
    z-index: 2;
}

.company-card .card-body {
    position: relative;
    z-index: 2;
}

.company-card .btn {
    transition: all 0.3s ease;
}

.company-card .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

/* Animación de entrada para las tarjetas */
.company-card {
    animation: slideInUp 0.6s ease-out;
    animation-fill-mode: both;
}

.company-card:nth-child(1) { animation-delay: 0.1s; }
.company-card:nth-child(2) { animation-delay: 0.2s; }
.company-card:nth-child(3) { animation-delay: 0.3s; }
.company-card:nth-child(4) { animation-delay: 0.4s; }
.company-card:nth-child(5) { animation-delay: 0.5s; }
.company-card:nth-child(6) { animation-delay: 0.6s; }
.company-card:nth-child(7) { animation-delay: 0.7s; }
.company-card:nth-child(8) { animation-delay: 0.8s; }
.company-card:nth-child(9) { animation-delay: 0.9s; }

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Efecto de hover simple y profesional */
.company-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    transform: translateY(-2px);
}
</style>

<!-- ===== CONTENIDO PRINCIPAL ===== -->
<div class="container-fluid">
                </div>
            </div>
        </div>
    </div>

    <!-- ===== BÚSQUEDA Y FILTROS ===== -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-search me-2"></i>
                        Buscar y Filtrar Empresas
                    </h5>
                </div>
                <div class="card-body">
                    <form method="get" class="row g-3">
                        <div class="col-md-2">
                            <label class="form-label">Nombre de Empresa</label>
                            <input type="text" class="form-control" name="search" value="{{ request.GET.search }}" placeholder="Buscar empresa...">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Ciudad</label>
                            <select class="form-select" name="city">
                                <option value="">Todas las ciudades</option>
                                {% for city in cities %}
                                    <option value="{{ city }}" {% if request.GET.city == city %}selected{% endif %}>{{ city }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Sector</label>
                            <select class="form-select" name="sector">
                                <option value="">Todos los sectores</option>
                                {% for sector in sectors %}
                                    <option value="{{ sector }}" {% if request.GET.sector == sector %}selected{% endif %}>{{ sector }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Modalidad</label>
                            <select class="form-select" name="modality">
                                <option value="">Todas las modalidades</option>
                                {% for value, label in modality_choices %}
                                    <option value="{{ value }}" {% if request.GET.modality == value %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-primary flex-fill">
                                    <i class="fas fa-search me-1"></i>
                                    Buscar
                                </button>
                                <a href="{% url 'dashboard' %}" class="btn btn-secondary" title="Limpiar filtros">
                                    <i class="fas fa-times"></i>
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== RESEÑAS PENDIENTES ===== -->
    {% if pending_reviews %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-warning">
                <div class="card-header bg-warning text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Reseñas Pendientes
                        </h5>
                        <a href="{% url 'create_review' %}" class="btn btn-light btn-sm">
                            <i class="fas fa-plus me-1"></i>
                            Crear Reseña
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Importante:</strong> Tienes reseñas pendientes para las siguientes empresas. 
                        Completa tu reseña para desbloquear el contenido completo de cada empresa.
                    </p>
                    <div class="row">
                        {% for pending in pending_reviews %}
                        <div class="col-md-6 mb-3">
                            <div class="card border-warning h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h6 class="card-title text-warning mb-0">
                                            <i class="fas fa-building me-2"></i>
                                            {{ pending.company.name }}
                                        </h6>
                                        <span class="badge bg-warning">Pendiente</span>
                                    </div>
                                    <p class="card-text small text-muted">
                                        <i class="fas fa-briefcase me-1"></i>
                                        <strong>Cargo:</strong> {{ pending.job_title }}
                                    </p>
                                    <p class="card-text small text-muted">
                                        <i class="fas fa-calendar me-1"></i>
                                        <strong>Participaste el:</strong> {{ pending.participation_date|date:"d M Y" }}
                                    </p>
                                    <div class="mt-3">
                                        <a href="{% url 'create_review' %}?company={{ pending.company.id }}" class="btn btn-warning btn-sm w-100">
                                            <i class="fas fa-edit me-1"></i>
                                            Crear Reseña Ahora
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- ===== LISTA DE EMPRESAS ===== -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-list me-2"></i>
                        Empresas Disponibles
                    </h5>
                </div>
                <div class="card-body">
                    {% if companies %}
                        <div class="row">
                            {% for company in companies %}
                            <div class="col-md-6 col-lg-4 mb-4">
                                <div class="card h-100 company-card" style="background: #ffffff; border: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.3s ease;">
                                    <div class="card-header" style="background: #f8fafc; border-bottom: 1px solid #e5e7eb;">
                                        <h6 class="card-title mb-0 fw-bold" style="color: #1e3a8a;">{{ company.name }}</h6>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text small mb-2" style="color: #6b7280;">
                                            <i class="fas fa-map-marker-alt me-1" style="color: #ef4444;"></i>
                                            {{ company.location }}{% if company.region %}, {{ company.region }}{% endif %} - {{ company.country }}
                                        </p>
                                        <p class="card-text small mb-2" style="color: #6b7280;">
                                            <i class="fas fa-industry me-1" style="color: #1e3a8a;"></i>
                                            {{ company.sector }}
                                        </p>
                                        
                                        <!-- ===== ESTADO DE LA EMPRESA ===== -->
                                        {% if company.has_pending_review %}
                                            <div class="alert py-2 mb-2" style="background: #fef3c7; border: 1px solid #f59e0b; color: #92400e;">
                                                <small>
                                                    <i class="fas fa-clock me-1"></i>
                                                    <strong>Reseña Pendiente</strong><br>
                                                    Tienes una reseña pendiente para esta empresa
                                                </small>
                                            </div>
                                        {% elif company.has_completed_review %}
                                            <div class="alert py-2 mb-2" style="background: #d1fae5; border: 1px solid #10b981; color: #065f46;">
                                                <small>
                                                    <i class="fas fa-check me-1"></i>
                                                    <strong>Reseña Completada</strong><br>
                                                    Ya tienes acceso completo al contenido
                                                </small>
                                            </div>
                                        {% endif %}
                                        
                                        <div class="d-flex justify-content-between align-items-center">
                                            <a href="{% url 'company_detail' company.id %}" class="btn btn-sm" style="background: #1e3a8a; border: none; color: white;">
                                                <i class="fas fa-eye me-1"></i>
                                                Ver Detalles
                                            </a>
                                            {% if company.has_pending_review %}
                                                <a href="{% url 'create_review' %}?company={{ company.id }}" class="btn btn-sm" style="background: #f59e0b; border: none; color: white; font-weight: bold;">
                                                    <i class="fas fa-edit me-1"></i>
                                                    Crear Reseña
                                                </a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-building fa-3x text-muted mb-3"></i>
                            <p class="text-muted">No hay empresas disponibles en este momento.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- ===== GRÁFICOS DEL USUARIO ===== -->
    {% if chart_data.ratings or chart_data.modality or chart_data.status or chart_data.timeline or chart_data.sector_satisfaction %}
    <div class="row mt-5">
        <div class="col-12">
            <h4 class="text-primary mb-4">
                <i class="fas fa-chart-bar me-2"></i>
                Mis Estadísticas
            </h4>
        </div>
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h6 class="card-title mb-0">Mis Calificaciones</h6>
                </div>
                <div class="card-body">
                    {% if chart_data.ratings %}
                    <canvas id="userRatingsChart" width="400" height="200"></canvas>
                    {% else %}
                    <p class="text-muted small">No hay datos para mostrar el gráfico</p>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h6 class="card-title mb-0">Modalidades de Trabajo</h6>
                </div>
                <div class="card-body">
                    {% if chart_data.modality %}
                    <canvas id="userModalityChart" width="400" height="200"></canvas>
                    {% else %}
                    <p class="text-muted small">No hay datos para mostrar el gráfico</p>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h6 class="card-title mb-0">Satisfacción por Sector</h6>
                </div>
                <div class="card-body">
                    {% if chart_data.sector_satisfaction %}
                    <canvas id="userSectorChart" width="400" height="200"></canvas>
                    {% else %}
                    <p class="text-muted small">No hay datos para mostrar el gráfico</p>
                    {% endif %}
                </div>
            </div>
        </div>
    {% endif %}

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

{{ chart_data|json_script:"user-chart-data" }}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Datos de los gráficos del usuario
    const userChartData = JSON.parse(document.getElementById('user-chart-data').textContent);
    
    // Colores para los gráficos
    const colors = {
        primary: '#1E3A8A',
        success: '#10B981',
        warning: '#F59E0B',
        danger: '#EF4444',
        info: '#3B82F6',
        secondary: '#6B7280'
    };
    
    // Gráfico de calificaciones del usuario
    if (userChartData.ratings && Object.keys(userChartData.ratings).length > 0) {
        const ratingsCtx = document.getElementById('userRatingsChart');
        if (ratingsCtx) {
            new Chart(ratingsCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(userChartData.ratings),
                    datasets: [{
                        label: 'Mis Calificaciones',
                        data: Object.values(userChartData.ratings),
                        backgroundColor: [colors.warning, colors.warning, colors.warning, colors.warning, colors.warning],
                        borderColor: [colors.warning, colors.warning, colors.warning, colors.warning, colors.warning],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
    }
    
    // Gráfico de modalidad del usuario
    if (userChartData.modality && Object.keys(userChartData.modality).length > 0) {
        const modalityCtx = document.getElementById('userModalityChart');
        if (modalityCtx) {
            new Chart(modalityCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(userChartData.modality),
                    datasets: [{
                        data: Object.values(userChartData.modality),
                        backgroundColor: [colors.primary, colors.success, colors.info],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true
                }
            });
        }
    }
    
    // Gráfico de satisfacción por sector del usuario
    if (userChartData.sector_satisfaction && Object.keys(userChartData.sector_satisfaction).length > 0) {
        const sectorCtx = document.getElementById('userSectorChart');
        if (sectorCtx) {
            new Chart(sectorCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(userChartData.sector_satisfaction),
                    datasets: [{
                        label: 'Calificación Promedio',
                        data: Object.values(userChartData.sector_satisfaction),
                        backgroundColor: colors.primary,
                        borderColor: colors.primaryDark,
                        borderWidth: 2,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
    }
});
</script>

{% endblock %}